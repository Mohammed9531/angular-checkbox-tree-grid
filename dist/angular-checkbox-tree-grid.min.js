/**
 * angular-checkbox-tree-grid.js v1.0.1
 * --------------------------------------------------------------------
 *
 * AngularJS Checkbox Tree Gird Directive
 * @author Shoukath Mohammed <mshoukath.uideveloper@gmail.com>
 *
 * Copyright (C) 2016
 *
 * MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

 !function(){"use strict";function e(e){function n(n,t,r){n.$watch(r.compile,function(r){var l=e(r),i=l(n);t.append(i)})}return{restrict:"A",link:n}}function n(){var e=function(e){var n,t,r=this;n=e.config?e.config.childrenKeyName:"children",this.results=[],this.config=e.config,this.expandingProperty=e.ep,this.processTreeData=function(e,l,i,a){var o,c;e=e||[],l=l||1,i=!angular.isDefined(i)||i;for(var d=0;d<e.length;d++)t=""+Math.random(),c=20*(l-1),o=r.treeIconController(e[d],l,"iconExpand"),r.results.push({pid:a,uid:t,cid:"c"+(11*l+d),branch:e[d],level:l,visible:i,expanded:!1,tree_icon:o,styling:{indentation:l>1?""+c:"0",text_indent:""===o?""+(c+20):""+c}}),angular.isArray(e[d][n])&&e[d][n].length&&r.processTreeData(e[d][n],l+1,!1,t);return r.attachChildNodes(r.results),r.results},this.flattenTreeData=function(e){var t=[],r=function(e){for(var l=0;l<e.length;l++)t.push(e[l]),e[l][n].length&&r(e[l][n])};return r(e),t},this.attachChildNodes=function(e){angular.forEach(e,function(n,t){e[t].children=r.getChildNodes(e,e[t].uid)||[]})},this.onDataChange=function(e,n){r.results=[],r.processTreeData(e)},this.onBranchChange=function(e,n){return e.filter(function(e){return angular.isDefined(n)&&n?e.branch.selected:!e.branch.selected})},this.onToggle=function(e,n){angular.forEach(n,function(t,l){angular.isUndefined(n[l].pid)||n[l].pid!=e.uid||(n[l].visible=e.expanded,!e.expanded&&n[l].expanded&&(n[l].expanded=!1),n[l].children.length&&r.onToggle(n[l],n))})},this.onRootSelect=function(e){for(var n=0;n<r.results.length;n++)r.results[n].branch.selected=e},this.reduceTreeData=function(){return r.onBranchChange(r.results,!0).map(function(e){return e.branch})},this.onSelect=function(e,n,t){t||(r.checkChildNodes(e,n),r.updateNodesCheck(e.level,r.results))},this.getDeselectedNodes=function(){return r.onBranchChange(r.results,!1)},this.isRootNodeSelected=function(){var e=r.getDeselectedNodes();return!angular.isArray(e)||!e.length},this.getTreeModel=function(){return r.onBranchChange(r.results,!0)},this.checkChildNodes=function(e,t){for(var l=0;l<r.results.length;l++)r.results[l].pid==e.uid&&(r.results[l].branch.selected=t,r.results[l].branch[n].length&&r.checkChildNodes(r.results[l],t))},this.getNodes=function(e,n){return e.filter(function(e){return e.level==n})},this.getProcessedData=function(){var e=r.results||[];return e.length?e.map(function(e){return e.branch}):e},this.recursiveCheck=function(e,t){t=t||1;for(var l=r.getNodes(e,t),i=0;i<l.length;i++){var a=r.getChildNodes(e,l[i].uid)||[];if(a.length){l[i].branch.selected=a.every(r.allSelected);for(var o=0;o<a.length;o++)a[o].branch[n].length&&r.recursiveCheck(e,t+1)}}},this.updateNodesCheck=function(e,n){for(;e>0;)r.recursiveCheck(n,e),e--},this.getChildNodes=function(e,n){return e.filter(function(e){return e.pid==n})},this.allSelected=function(e){return e.branch.selected},this.onChildSelection=function(e,n){if(angular.isArray(n)&&n.length)for(var t=0;t<e.length;t++)for(var r=0;r<n.length;r++)n[r].level>1&&n[r].pid==e[t].uid&&(e[t].branch.selected=n[r].branch.selected)},this.onBranchToggle=function(e){var n="";e.children.length&&(e.expanded=!e.expanded,n=e.expanded?"iconCollapse":"iconExpand",e.tree_icon=r.treeIconController(e.branch,e.level,n),r.onToggle(e,r.results))},this.onTreeDataChange=function(e,n){return r.onBranchChange(e,!0)},this.onTreeModelChange=function(e,n){if(angular.isArray(e))for(var t=0;t<e.length;t++)for(var l=0;l<r.results.length;l++)e[t][r.expandingProperty.field]==r.results[l].branch[r.expandingProperty.field]&&(r.results[l].branch.selected=e[t].selected)},this.clearAllSelectedNodes=function(e){if(angular.isArray(e)){for(var t=0;t<e.length;t++)delete e[t].selected,e[t][n].length&&r.clearAllSelectedNodes(e[t][n]);return e}return[]},this.highlightSelectedNode=function(e){var n=angular.element(e.currentTarget).parent()[0];"TD"==n.nodeName&&(n=angular.element(n.parentNode)),this.find(".highlighted").removeClass("highlighted"),n.addClass("highlighted")},this.treeIconController=function(e,t,l){var i="";if(e&&angular.isArray(e[n])&&e[n].length){var a=r.config[l];i=angular.isObject(a)?a["level_"+t]||a.level_1:a}else i=r.config.iconIndividual||"";return i}};return{init:function(n){return new e(n)}}}function t(e,n,t,r,l){function i(e,n){return n.templateUrl?n.templateUrl:l[n.gridType?"getTemplatePath":"getTemplate"](n.gridType)}function a(e,n,l){var i,a;e.expandingProperty=e.expandOn,e.init=function(){var n;i=angular.extend({},t.getGridConfig(),e.treeConfig),angular.extend(e,i),e.treeConfig=i,a=r.init({config:i,ep:e.expandOn}),e.checkboxTree?n=e.treeData:(delete e.treeModel,e.rootNode=!1,n=a.clearAllSelectedNodes(e.treeData)),e.render(n)},e.updateModel=function(){e.checkboxTree&&(e.treeModel=a.getTreeModel(),e.rootNode=a.isRootNodeSelected())},e.render=function(n){a.results=[],e.treeRows=a.processTreeData(n)||[],e.treeProcessedNodes=a.getProcessedData(),e.updateModel()},e.onDataChange=function(n,t){var r=a.flattenTreeData(n),l=a.flattenTreeData(t);angular.isArray(n)&&angular.isArray(t)&&((r.length>l.length||r.length<l.length)&&(a.results=[],e.render(n)),e.updateModel())},e.init(),e.onBranchToggle=function(e){a.onBranchToggle(e)},e.onSelect=function(n,t){a.onSelect(n,t,e.individualSelect)},e.onRowClick=function(t,r){e.highlightSelected&&a.highlightSelectedNode.call(n,t),e.onBranchClick({branch:r})},e.onRootSelect=function(n){a.onRootSelect(n),e.treeModel=a.getTreeModel()},e.$watch("treeConfig",e.init,!0),e.$watch("treeData",e.onDataChange,!0),e.$watch("treeModel",a.onTreeModelChange,!0)}return{restrict:"E",replace:!0,scope:{colDefs:"=",expandOn:"=",onSelect:"&",treeData:"=",onBranchClick:"&",treeModel:"=?treeModel",treeConfig:"=?treeConfig",treeControl:"=?treeControl",treeProcessedNodes:"=?treeProcessedNodes"},link:a,templateUrl:i}}function r(e){var n=this;this.getTemplate=function(){var t=e.getGridConfig().gridType;return n.getTemplatePath(t)},this.getTemplatePath=function(e){var n={};return n.listGrid="template/list/angularCheckBoxTreeList.html",n.checkboxGrid="template/grid/angularCheckBoxTreeGrid.html",n[e]}}function l(){function e(e){l=e}function n(){return l}function t(e){i=angular.extend({},i,e)}function r(){return i}var l="template/grid/angularCheckBoxTreeGrid.html",i={expandLevel:0,iconIndividual:"",checkboxTree:!1,individualSelect:!1,gridType:"checkboxGrid",highlightSelected:!1,childrenKeyName:"children",iconExpand:"fa fa-angle-right",iconCollapse:"fa fa-angle-down",tableType:"table table-bordered table-striped table-hover"};this.setPath=e,this.setGridConfig=t,this.$get=function(){return{getPath:n,getGridConfig:r}}}function i(e){e.put("template/grid/angularCheckBoxTreeGrid.html",'<div class="table-responsive">\n <table class="tree-grid" ng-class="tableType">\n   <thead>\n     <tr>\n        <th style="width:5%;" ng-show="checkboxTree">\n           <input type="checkbox" ng-click="onRootSelect(rootNode)" ng-model="rootNode" />\n       </th>\n       <th>{{expandingProperty.displayName || expandingProperty.field || expandingProperty}}</th>\n       <th ng-repeat="col in colDefinitions">{{col.displayName}}</th>\n     </tr>\n   </thead>\n   <tbody>\n     <tr ng-repeat="row in treeRows | filter:{visible:true} track by row.uid"\n       ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\': \'\')" class="tree-grid-row">\n       <td class="role-checkbox-tree-node" style="width:5%;" ng-if="checkboxTree">\n         <input class="node-control" name="nodeControl" type="checkbox" ng-model="row.branch.selected" ng-click="onSelect(row, row.branch.selected)" />\n       </td>\n       <td>\n           <a ng-click="(row.branch.children.length) ? onBranchToggle(row) : \'\'" class="tree-branch-anchor">\n              <i ng-class="row.tree_icon" ng-style="{\'position\': \'relative\', \'left\': row.styling.indentation + \'px\', \'width\': \'15px\'}"></i>\n           </a>           <span class="tree-label" ng-click="onRowClick($event, row.branch)"\n             ng-style="{\'position\': \'relative\', \'left\': row.styling.text_indent + \'px\'}">\n             {{row.branch[expandingProperty.field] || row.branch[expandingProperty]}}\n           </span>\n       </td>\n       <td ng-repeat="col in colDefinitions">\n         <div ng-if="col.cellTemplate" compile="col.cellTemplate"></div>\n         <div ng-if="!col.cellTemplate">{{row.branch[col.field]}}</div>\n       </td>\n     </tr>\n   </tbody>\n </table>\n</div>\n'),e.put("template/list/angularCheckBoxTreeList.html",'<ul class="nav nav-list nav-pills nav-stacked list-tree">\n <li ng-repeat="row in treeRows | filter:{visible:true} track by row.uid" \n   ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \'active\': \'\')">\n   <a ng-click="(row.branch.children.length) ? onBranchToggle(row) : \'\'">\n     <i ng-class="row.tree_icon" class="indented tree-icon"></i>\n     <span class="indented tree-label" ng-click="onRowClick($event, row.branch)">{{ row.branch[expandingProperty.field] || row.branch[expandingProperty] }}</span>\n   </a>\n </li>\n</ul>\n')}angular.module("ngCheckboxTreeGrid",["angular-checkbox-tree-grid"]),angular.module("ngCheckboxTreeGrid").directive("compile",e),e.$inject=["$compile"],angular.module("ngCheckboxTreeGrid").factory("NgTreeDataFactory",n),angular.module("ngCheckboxTreeGrid").directive("ngCheckboxTreeGrid",t),t.$inject=["$timeout","$templateCache","NgCheckboxTree","NgTreeDataFactory","NgTreeTemplatesService"],angular.module("ngCheckboxTreeGrid").service("NgTreeTemplatesService",r),r.$inject=["NgCheckboxTree"],angular.module("ngCheckboxTreeGrid").provider("NgCheckboxTree",l),angular.module("angular-checkbox-tree-grid",[]),angular.module("angular-checkbox-tree-grid").run(i),i.$inject=["$templateCache"]}();