/**
 * angular-checkbox-tree-grid.js v1.0.1
 * --------------------------------------------------------------------
 *
 * AngularJS Checkbox Tree Gird Directive
 * @author Shoukath Mohammed <mshoukath.uideveloper@gmail.com>
 *
 * Copyright (C) 2016
 *
 * MIT License
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

 !function(){"use strict";function e(e){function n(n,t,r){n.$watch(r.compile,function(r){var i=e(r),l=i(n);t.append(l)})}return{restrict:"A",link:n}}function n(e,n,t,r){function i(e,n){return n.templateUrl?n.templateUrl:r[n.gridType?"getTemplatePath":"getTemplate"](n.gridType)}function o(e,n,r){var i,o;e.expandingProperty=e.expandOn,e.init=function(){var n;i=angular.extend({},t.getGridConfig(),e.treeConfig),e.checkboxTree=i.checkboxTree,e.individualSelect=i.individualSelect,o=new l({config:i,ep:e.expandOn}),e.checkboxTree?n=e.treeData:(e.treeModel=[],e.rootNode=!1,n=o.clearAllSelectedNodes(e.treeData)),e.treeRows=o.flattenTreeData(n)||[]},e.init(),e.$watch("treeConfig",e.init,!0),e.$watch("treeModel",o.onTreeModelChange,!0),e.onBranchToggle=function(e){o.onBranchToggle(e)},e.onSelect=function(n,t){o.onSelect(n,t,e.individualSelect),e.treeModel=o.getTreeModel(),e.rootNode=o.isRootNodeSelected()},e.onRootSelect=function(n){o.onRootSelect(n),e.treeModel=o.getTreeModel()}}return{restrict:"E",replace:!0,scope:{colDefs:"=",expandOn:"=",onSelect:"&",treeData:"=",treeModel:"=",treeConfig:"=",treeControl:"=",onBranchClick:"&"},link:o,templateUrl:i}}function t(e){var n=this;this.getTemplate=function(){var t=e.getGridConfig().gridType;return n.getTemplatePath(t)},this.getTemplatePath=function(e){var n={};return n.listGrid="template/list/angularCheckBoxTreeList.html",n.checkboxGrid="template/grid/angularCheckBoxTreeGrid.html",n[e]}}function r(){function e(e){i=e}function n(){return i}function t(e){l=angular.extend({},l,e)}function r(){return l}var i="template/grid/angularCheckBoxTreeGrid.html",l={expandLevel:0,checkboxTree:!1,gridType:"checkboxGrid",childrenKeyName:"children",iconIndividual:"",iconCollapse:"fa fa-angle-down",iconExpand:"fa fa-angle-right",tableType:"table-bordered table-striped table-hover",individualSelect:!1};this.setPath=e,this.setGridConfig=t,this.$get=function(){return{getPath:n,getGridConfig:r}}}function i(e){e.put("template/grid/angularCheckBoxTreeGrid.html",'<div class="table-responsive">\n <table class="table table-bordered table-striped tree-grid">\n   <thead>\n     <tr>\n        <th style="width:5%;" ng-show="checkboxTree">\n           <input type="checkbox" ng-click="onRootSelect(rootNode)" ng-model="rootNode" />\n       </th>\n       <th>{{expandingProperty.displayName || expandingProperty.field || expandingProperty}}</th>\n       <th ng-repeat="col in colDefinitions">{{col.displayName}}</th>\n     </tr>\n   </thead>\n   <tbody>\n     <tr ng-repeat="row in treeRows | filter:{visible:true} track by row.uid"\n       ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \'active\': \'\')" class="tree-grid-row">\n       <td class="role-checkbox-tree-node" style="width:5%;" ng-if="checkboxTree">\n         <input class="node-control" name="nodeControl" type="checkbox" ng-model="row.branch.selected" ng-click="onSelect(row, row.branch.selected)" />\n       </td>\n       <td>\n           <a ng-click="onBranchToggle(row)" class="tree-branch-anchor">\n              <i ng-class="row.tree_icon" ng-style="{\'position\': \'relative\', \'left\': row.styling.indentation + \'px\', \'width\': \'15px\'}"></i>\n           </a>           <span class="tree-label" ng-click="onBranchClick({branch: row.branch})"\n             ng-style="{\'position\': \'relative\', \'left\': row.styling.text_indent + \'px\'}">\n             {{row.branch[expandingProperty.field] || row.branch[expandingProperty]}}\n           </span>\n       </td>\n       <td ng-repeat="col in colDefinitions">\n         <div ng-if="col.cellTemplate" compile="col.cellTemplate"></div>\n         <div ng-if="!col.cellTemplate">{{row.branch[col.field]}}</div>\n       </td>\n     </tr>\n   </tbody>\n </table>\n</div>\n'),e.put("template/list/angularCheckBoxTreeList.html",'<ul class="nav nav-list nav-pills nav-stacked list-tree">\n <li ng-repeat="row in treeRows | filter:{visible:true} track by row.uid" \n   ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \'active\': \'\')">\n   <a ng-click="(row.branch.children.length) ? onBranchToggle(row) : \'\'">\n     <i ng-class="row.tree_icon" class="indented tree-icon"></i>\n     <span class="indented tree-label" ng-click="onBranchClick({branch: row.branch})">{{ row.branch[expandingProperty.field] || row.branch[expandingProperty] }}</span>\n   </a>\n </li>\n</ul>\n')}angular.module("ngCheckboxTreeGrid",["angular-checkbox-tree-grid"]),angular.module("ngCheckboxTreeGrid").directive("compile",e),e.$inject=["$compile"];var l=function(e){var n,t,r=this;n=e.config?e.config.childrenKeyName:"children",this.results=[],this.config=e.config,this.expandingProperty=e.ep,this.flattenTreeData=function(e,i,l,o){var a,c;e=e||[],i=i||1,l=!angular.isDefined(l)||l;for(var d=0;d<e.length;d++)t=""+Math.random(),c=20*(i-1),a=r.treeIconController(e[d],i,"iconExpand"),r.results.push({pid:o,uid:t,cid:"c"+(11*i+d),branch:e[d],level:i,visible:l,expanded:!1,tree_icon:a,styling:{indentation:i>1?""+c:"0",text_indent:""===a?""+(c+20):""+c}}),angular.isArray(e[d][n])&&e[d][n].length&&r.flattenTreeData(e[d][n],i+1,!1,t);return r.attachChildNodes(r.results),r.results},this.attachChildNodes=function(e){angular.forEach(e,function(n,t){e[t].children=r.getChildNodes(e,e[t].uid)||[]})},this.onDataChange=function(e,n){r.results=[],r.flattenTreeData(e)},this.onBranchChange=function(e,n){return e.filter(function(e){return angular.isDefined(n)&&n?e.branch.selected:!e.branch.selected})},this.onToggle=function(e,n){angular.forEach(n,function(t,i){angular.isUndefined(n[i].pid)||n[i].pid!=e.uid||(n[i].visible=e.expanded,!e.expanded&&n[i].expanded&&(n[i].expanded=!1),n[i].children.length&&r.onToggle(n[i],n))})},this.onRootSelect=function(e){for(var n=0;n<r.results.length;n++)r.results[n].branch.selected=e},this.reduceTreeData=function(){return r.onBranchChange(r.results,!0).map(function(e){return e.branch})},this.onSelect=function(e,n,t){t||(r.checkChildNodes(e,n),r.updateNodesCheck(e.level,r.results))},this.getDeselectedNodes=function(){return r.onBranchChange(r.results,!1)},this.isRootNodeSelected=function(){var e=r.getDeselectedNodes(),n=!angular.isArray(e)||!e.length;return n},this.getTreeModel=function(){return r.onBranchChange(r.results,!0)},this.checkChildNodes=function(e,t){for(var i=0;i<r.results.length;i++)r.results[i].pid==e.uid&&(r.results[i].branch.selected=t,r.results[i].branch[n].length&&r.checkChildNodes(r.results[i],t))},this.getNodes=function(e,n){return e.filter(function(e){return e.level==n})},this.recursiveCheck=function(e,t){t=t||1;for(var i=r.getNodes(e,t),l=0;l<i.length;l++){var o=r.getChildNodes(e,i[l].uid)||[];if(o.length){i[l].branch.selected=o.every(r.allSelected);for(var a=0;a<o.length;a++)o[a].branch[n].length&&r.recursiveCheck(e,t+1)}}},this.updateNodesCheck=function(e,n){for(;e>0;)r.recursiveCheck(n,e),e--},this.getChildNodes=function(e,n){return e.filter(function(e){return e.pid==n})},this.allSelected=function(e){return e.branch.selected},this.onChildSelection=function(e,n){if(angular.isArray(n)&&n.length)for(var t=0;t<e.length;t++)for(var r=0;r<n.length;r++)n[r].level>1&&n[r].pid==e[t].uid&&(e[t].branch.selected=n[r].branch.selected)},this.onBranchToggle=function(e){var n="";e.children.length&&(e.expanded=!e.expanded,n=e.expanded?"iconCollapse":"iconExpand",e.tree_icon=r.treeIconController(e.branch,e.level,n),r.onToggle(e,r.results))},this.onTreeDataChange=function(e,n){return r.onBranchChange(e,!0)},this.onTreeModelChange=function(e,n){if(angular.isArray(e))for(var t=0;t<e.length;t++)for(var i=0;i<r.results.length;i++)e[t][r.expandingProperty.field]==r.results[i].branch[r.expandingProperty.field]&&(r.results[i].branch.selected=e[t].selected)},this.clearAllSelectedNodes=function(e){if(angular.isArray(e)){for(var t=0;t<e.length;t++)delete e[t].selected,e[t][n].length&&r.clearAllSelectedNodes(e[t][n]);return e}return[]},this.treeIconController=function(e,t,i){var l="";return l=e&&e[n].length?angular.isObject(r.config[i])?r.config[i]["level_"+t]||r.config[i].level_1:r.config[i]:r.config.iconIndividual||""}};angular.module("ngCheckboxTreeGrid").directive("ngCheckboxTreeGrid",n),n.$inject=["$timeout","$templateCache","NgCheckboxTree","NgTreeTemplatesService"],angular.module("ngCheckboxTreeGrid").service("NgTreeTemplatesService",t),t.$inject=["NgCheckboxTree"],angular.module("ngCheckboxTreeGrid").provider("NgCheckboxTree",r),angular.module("angular-checkbox-tree-grid",[]),angular.module("angular-checkbox-tree-grid").run(i),i.$inject=["$templateCache"]}();